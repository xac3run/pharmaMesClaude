<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nobilis.Tech MES</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    // ----------------------------
    // Components
    // ----------------------------
    const NavButton = ({ tab, activeTab, setActiveTab, icon, label }) => (
      <button
        onClick={() => setActiveTab(tab)}
        className={`px-6 py-3 font-medium border-b-2 transition-colors ${
          activeTab === tab
            ? "border-blue-500 text-blue-600"
            : "border-transparent text-gray-500 hover:text-gray-700"
        }`}
      >
        {icon} {label}
      </button>
    );

    const StepRow = ({ step, onUpdate, onRemove, onAddMaterial }) => {
      const handleChange = (field, value) => {
        onUpdate({ ...step, [field]: value });
      };

      return (
        <div className="border p-4 rounded-lg mb-2 bg-gray-50">
          <div className="flex items-center mb-2 gap-2">
            <input
              type="text"
              value={step.name}
              onChange={(e) => handleChange("name", e.target.value)}
              className="flex-1 border p-2 rounded text-sm"
              placeholder="Step name"
            />
            <select
              value={step.type}
              onChange={(e) => handleChange("type", e.target.value)}
              className="border p-2 rounded text-sm"
            >
              <option>Instruction</option>
              <option>Data Entry</option>
              <option>Control</option>
              <option>CCP</option>
              <option>Pause</option>
            </select>
            <button
              onClick={onRemove}
              className="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm"
            >
              ‚úñ
            </button>
          </div>
          {/* Parameters */}
          <div className="flex gap-2 mb-2">
            <input
              type="number"
              value={step.min || ""}
              onChange={(e) => handleChange("min", e.target.value)}
              className="border p-2 rounded text-sm w-24"
              placeholder="Min"
            />
            <input
              type="number"
              value={step.max || ""}
              onChange={(e) => handleChange("max", e.target.value)}
              className="border p-2 rounded text-sm w-24"
              placeholder="Max"
            />
          </div>
          {/* Materials */}
          <div>
            <h4 className="font-medium text-sm mb-1">Materials</h4>
            {step.materials.map((m, i) => (
              <div key={i} className="flex gap-2 mb-1">
                <input
                  type="text"
                  value={m.id}
                  onChange={(e) => {
                    const newM = [...step.materials];
                    newM[i].id = e.target.value;
                    handleChange("materials", newM);
                  }}
                  className="border p-2 rounded text-sm flex-1"
                  placeholder="Material ID"
                />
                <select
                  value={m.status}
                  onChange={(e) => {
                    const newM = [...step.materials];
                    newM[i].status = e.target.value;
                    handleChange("materials", newM);
                  }}
                  className="border p-2 rounded text-sm"
                >
                  <option>valid</option>
                  <option>quarantine</option>
                  <option>blocked</option>
                </select>
              </div>
            ))}
            <button
              onClick={onAddMaterial}
              className="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm"
            >
              ‚ûï Add Material
            </button>
          </div>
        </div>
      );
    };

    // ----------------------------
    // Main App
    // ----------------------------
    const App = () => {
      const [activeTab, setActiveTab] = useState("dashboard");
      const [templates, setTemplates] = useState([
        {
          id: 1,
          name: "Aspirin 325mg - Tableting",
          steps: [
            { name: "Weighing", type: "Data Entry", min: 100, max: 110, materials: [] },
          ],
        },
      ]);
      const [auditLog, setAuditLog] = useState([]);

      const logAction = (msg) => {
        setAuditLog((prev) => [
          { ts: new Date().toLocaleString(), msg },
          ...prev,
        ]);
      };

      const addStep = (templateId) => {
        setTemplates((prev) =>
          prev.map((t) =>
            t.id === templateId
              ? {
                  ...t,
                  steps: [...t.steps, { name: "New Step", type: "Instruction", materials: [] }],
                }
              : t
          )
        );
        logAction(`‚ûï Added step to template ${templateId}`);
      };

      const updateStep = (templateId, index, newStep) => {
        setTemplates((prev) =>
          prev.map((t) =>
            t.id === templateId
              ? { ...t, steps: t.steps.map((s, i) => (i === index ? newStep : s)) }
              : t
          )
        );
        logAction(`‚úèÔ∏è Updated step #${index + 1} in template ${templateId}`);
      };

      const removeStep = (templateId, index) => {
        setTemplates((prev) =>
          prev.map((t) =>
            t.id === templateId
              ? { ...t, steps: t.steps.filter((_, i) => i !== index) }
              : t
          )
        );
        logAction(`‚ùå Removed step #${index + 1} from template ${templateId}`);
      };

      const addMaterial = (templateId, stepIndex) => {
        setTemplates((prev) =>
          prev.map((t) =>
            t.id === templateId
              ? {
                  ...t,
                  steps: t.steps.map((s, i) =>
                    i === stepIndex
                      ? { ...s, materials: [...s.materials, { id: "", status: "valid" }] }
                      : s
                  ),
                }
              : t
          )
        );
        logAction(`üì¶ Added material to step #${stepIndex + 1} in template ${templateId}`);
      };

      return (
        <div className="max-w-7xl mx-auto p-6">
          {/* Header */}
          <div className="flex items-center justify-between mb-6">
            <div className="flex items-center gap-3">
              <img src="assets/logo.svg" className="h-12 w-12" />
              <h1 className="text-3xl font-bold">üè≠ Nobilis.Tech MES</h1>
            </div>
            <span className="text-green-600 font-medium">‚úÖ Online</span>
          </div>

          {/* Navigation */}
          <div className="flex mb-6 border-b">
            <NavButton tab="dashboard" activeTab={activeTab} setActiveTab={setActiveTab} icon="üìä" label="Dashboard" />
            <NavButton tab="batches" activeTab={activeTab} setActiveTab={setActiveTab} icon="üß™" label="Batches" />
            <NavButton tab="templates" activeTab={activeTab} setActiveTab={setActiveTab} icon="üìã" label="eBR Templates" />
            <NavButton tab="workflow" activeTab={activeTab} setActiveTab={setActiveTab} icon="üîÑ" label="Workflow" />
            <NavButton tab="audit" activeTab={activeTab} setActiveTab={setActiveTab} icon="üìú" label="Audit Trail" />
          </div>

          {/* Dashboard */}
          {activeTab === "dashboard" && (
            <div className="bg-white p-6 rounded-lg shadow-sm border">
              <h2 className="text-lg font-semibold">üìä Dashboard</h2>
              <p className="text-sm text-gray-600 mt-2">–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç KPI, –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä—Ç–∏–∏ –∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è.</p>
            </div>
          )}

          {/* Batches */}
          {activeTab === "batches" && (
            <div className="bg-white p-6 rounded-lg shadow-sm border">
              <h2 className="text-lg font-semibold">üß™ Batch Records</h2>
              <p className="text-sm text-gray-600 mt-2">–°–ø–∏—Å–æ–∫ –ø–∞—Ä—Ç–∏–π, —Å—Ç–∞—Ç—É—Å—ã –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.</p>
            </div>
          )}

          {/* Templates */}
          {activeTab === "templates" && (
            <div className="space-y-6">
              {templates.map((t) => (
                <div key={t.id} className="bg-white p-6 rounded-lg shadow-sm border">
                  <h3 className="text-lg font-semibold mb-4">{t.name}</h3>
                  {t.steps.map((s, i) => (
                    <StepRow
                      key={i}
                      step={s}
                      onUpdate={(ns) => updateStep(t.id, i, ns)}
                      onRemove={() => removeStep(t.id, i)}
                      onAddMaterial={() => addMaterial(t.id, i)}
                    />
                  ))}
                  <button
                    onClick={() => addStep(t.id)}
                    className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 text-sm"
                  >
                    ‚ûï Add Step
                  </button>
                </div>
              ))}
            </div>
          )}

          {/* Workflow */}
          {activeTab === "workflow" && (
            <div className="space-y-6">
              <div className="bg-blue-50 border border-blue-200 p-4 rounded-lg">
                <h3 className="font-semibold text-blue-800 mb-2">üéØ Workflow Goals</h3>
                <ul className="list-disc list-inside text-sm text-blue-700 space-y-1">
                  <li>–ü–æ—à–∞–≥–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–æ MBR</li>
                  <li>–§–∏–∫—Å–∞—Ü–∏—è –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</li>
                  <li>–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ GMP, 21 CFR Part 11, Annex 11, GAMP5</li>
                  <li>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∏, –∞—É–¥–∏—Ç-—Ç—Ä–µ–π–ª, –∫–æ–Ω—Ç—Ä–æ–ª—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π</li>
                </ul>
              </div>
              <div className="bg-white p-6 rounded-lg shadow-sm border">
                <h3 className="text-lg font-semibold mb-4">üìñ User Stories</h3>
                <p className="text-sm text-gray-600">WF-01‚Ä¶WF-06 (–æ–ø–µ—Ä–∞—Ç–æ—Ä, QA, –º–∞—Å—Ç–µ—Ä, –∞—É–¥–∏—Ç–æ—Ä).</p>
              </div>
            </div>
          )}

          {/* Audit Trail */}
          {activeTab === "audit" && (
            <div className="bg-white p-6 rounded-lg shadow-sm border">
              <h2 className="text-lg font-semibold mb-4">üìú Audit Trail</h2>
              {auditLog.length === 0 ? (
                <p className="text-gray-500">No actions recorded yet.</p>
              ) : (
                <ul className="space-y-2">
                  {auditLog.map((log, i) => (
                    <li key={i} className="text-sm">
                      <span className="text-gray-500">{log.ts}</span> ‚Äî {log.msg}
                    </li>
                  ))}
                </ul>
              )}
            </div>
          )}
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
