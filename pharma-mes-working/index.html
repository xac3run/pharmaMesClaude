<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nobilis.Tech MES</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    // –ü—Ä–æ—Å—Ç—ã–µ –∏–∫–æ–Ω–∫–∏ —á–µ—Ä–µ–∑ emoji
    const Icons = {
      Dashboard: () => <span>üìä</span>,
      Batch: () => <span>üß™</span>,
      Template: () => <span>üìã</span>,
      Workflow: () => <span>üîÑ</span>,
      Plus: () => <span>‚ûï</span>,
      Edit: () => <span>‚úèÔ∏è</span>,
      Save: () => <span>üíæ</span>,
      Trash: () => <span>üóëÔ∏è</span>,
      Check: () => <span>‚úÖ</span>,
      Alert: () => <span>‚ö†Ô∏è</span>,
      User: () => <span>üë§</span>,
      Materials: () => <span>üì¶</span>,
      Copy: () => <span>üìÑ</span>
    };

    // ---------------------------
    // Main App
    // ---------------------------
    function App() {
      const [activeTab, setActiveTab] = useState("dashboard");
      const [batches, setBatches] = useState([
        { id: "BR-2024-001", product: "Aspirin 325mg", status: "in_progress", progress: 65 },
        { id: "BR-2024-002", product: "Paracetamol 500mg", status: "completed", progress: 100 },
        { id: "BR-2024-003", product: "Ibuprofen 200mg", status: "deviation", progress: 45, deviation: "Temp exceeded" }
      ]);

      const [templates, setTemplates] = useState([
        { 
          id: 1, 
          name: "Aspirin 325mg - Tableting", 
          version: "1.0", 
          status: "approved", 
          createdDate: "2024-01-01",
          bom: [
            { id: 1, item: "Aspirin API", quantity: 325, unit: "mg", lotNumber: "ASP-240101" },
            { id: 2, item: "Microcrystalline Cellulose", quantity: 100, unit: "mg", lotNumber: "MCC-240102" }
          ],
          steps: [
            { 
              id: 1, 
              name: "Weighing", 
              type: "input", 
              param: "Weight", 
              min: 320, 
              max: 330, 
              instruction: "Weigh raw materials accurately",
              materials: [
                { id: 1, item: "Aspirin API", quantity: 325, unit: "mg", lotNumber: "ASP-240101" },
                { id: 2, item: "Microcrystalline Cellulose", quantity: 100, unit: "mg", lotNumber: "MCC-240102" }
              ]
            },
            { id: 2, name: "Compression", type: "instruction", instruction: "Compress tablets", materials: [] },
            { id: 3, name: "Visual QC", type: "control", param: "Defects", min: 0, max: 5, instruction: "Check for visual defects", materials: [] }
          ]
        },
        { 
          id: 2, 
          name: "Paracetamol 500mg - Coating", 
          version: "1.1", 
          status: "draft", 
          createdDate: "2024-01-05",
          bom: [
            { id: 1, item: "Paracetamol API", quantity: 500, unit: "mg", lotNumber: "PAR-240103" }
          ],
          steps: [
            { id: 1, name: "Core Preparation", type: "instruction", instruction: "Prepare tablet cores", materials: [] },
            { id: 2, name: "Coating", type: "input", param: "Thickness", min: 50, max: 100, unit: "Œºm", materials: [] }
          ]
        }
      ]);

      const [workflow, setWorkflow] = useState([
        { id: 1, name: "Weighing", type: "input", param: "Weight", min: 320, max: 330, value: null, status: "pending" },
        { id: 2, name: "Compression", type: "instruction", status: "pending" },
        { id: 3, name: "Visual QC", type: "control", param: "Defects", min: 0, max: 5, value: null, status: "pending" }
      ]);

      // –ù–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
      const [equipment, setEquipment] = useState([
        { id: 1, name: "Tablet Press #1", type: "Compression", status: "in_operation", location: "Production Hall A", lastCalibration: "2024-01-01", nextCalibration: "2024-04-01" },
        { id: 2, name: "Coating Pan #2", type: "Coating", status: "cleaning", location: "Production Hall B", lastCalibration: "2024-01-10", nextCalibration: "2024-04-10" },
        { id: 3, name: "Blender #3", type: "Mixing", status: "calibration", location: "Production Hall A", lastCalibration: "2024-01-15", nextCalibration: "2024-04-15" }
      ]);

      const [personnel, setPersonnel] = useState([
        { id: 1, name: "John Doe", role: "Operator", department: "Production", status: "active", lastTraining: "2024-01-01", certifications: ["GMP Basic", "Equipment Operation"] },
        { id: 2, name: "Jane Smith", role: "QC Analyst", department: "Quality", status: "active", lastTraining: "2024-01-05", certifications: ["QC Methods", "HPLC Operation"] },
        { id: 3, name: "Mike Johnson", role: "Supervisor", department: "Production", status: "training", lastTraining: "2024-01-20", certifications: ["Leadership", "GMP Advanced"] }
      ]);

      const [deviations, setDeviations] = useState([
        { id: 1, batchId: "BR-2024-003", description: "Temperature exceeded limits", status: "pending", reportedBy: "Mike Johnson", reportedDate: "2024-01-20", investigator: null },
        { id: 2, batchId: "BR-2024-001", description: "Minor weight variance", status: "approved", reportedBy: "John Doe", reportedDate: "2024-01-18", investigator: "Jane Smith" }
      ]);

      const [selectedTemplate, setSelectedTemplate] = useState(null);

      // ---------------------------
      // Batches logic
      // ---------------------------
      const completeStep = (id) => {
        setBatches(prev => prev.map(b => b.id === id
          ? { ...b, progress: Math.min(b.progress + 30, 100), status: b.progress + 30 >= 100 ? "completed" : "in_progress" }
          : b
        ));
      };

      const reportDeviation = (id) => {
        const deviationText = prompt("–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è:");
        if (deviationText) {
          const newDeviation = {
            id: Date.now(),
            batchId: id,
            description: deviationText,
            status: "pending",
            reportedBy: "Current User",
            reportedDate: new Date().toISOString().split('T')[0],
            investigator: null
          };
          setDeviations(prev => [...prev, newDeviation]);
          setBatches(prev => prev.map(b => b.id === id
            ? { ...b, status: "deviation", deviation: deviationText }
            : b
          ));
        }
      };

      const approveDeviation = (deviationId) => {
        const investigator = prompt("–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è:");
        if (investigator) {
          setDeviations(prev => prev.map(d => 
            d.id === deviationId ? { ...d, status: "approved", investigator } : d
          ));
        }
      };

      const rejectDeviation = (deviationId) => {
        const investigator = prompt("–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è:");
        if (investigator) {
          setDeviations(prev => prev.map(d => 
            d.id === deviationId ? { ...d, status: "rejected", investigator } : d
          ));
        }
      };

      // ---------------------------
      // Templates logic (Enhanced)
      // ---------------------------
      const addTemplate = () => {
        setTemplates(prev => [...prev, {
          id: Date.now(),
          name: "New Template",
          version: "0.1",
          status: "draft",
          createdDate: new Date().toISOString().split('T')[0],
          bom: [],
          steps: []
        }]);
      };

      const cloneTemplate = (templateId) => {
        const template = templates.find(t => t.id === templateId);
        if (template) {
          const newTemplate = {
            ...template,
            id: Date.now(),
            name: template.name + " (Copy)",
            version: "0.1",
            status: "draft",
            createdDate: new Date().toISOString().split('T')[0],
            bom: template.bom ? [...template.bom.map(item => ({ ...item, id: Date.now() + Math.random() }))] : [],
            steps: template.steps ? [...template.steps.map(step => ({ ...step, id: Date.now() + Math.random(), materials: step.materials ? [...step.materials.map(m => ({ ...m, id: Date.now() + Math.random() }))] : [] }))] : []
          };
          setTemplates(prev => [...prev, newTemplate]);
        }
      };

      const createNewVersion = (templateId) => {
        const template = templates.find(t => t.id === templateId);
        if (template) {
          const currentVersion = parseFloat(template.version);
          const newVersion = (currentVersion + 0.1).toFixed(1);
          const newTemplate = {
            ...template,
            id: Date.now(),
            version: newVersion,
            status: "draft",
            createdDate: new Date().toISOString().split('T')[0],
            bom: template.bom ? [...template.bom.map(item => ({ ...item, id: Date.now() + Math.random() }))] : [],
            steps: template.steps ? [...template.steps.map(step => ({ ...step, id: Date.now() + Math.random(), materials: step.materials ? [...step.materials.map(m => ({ ...m, id: Date.now() + Math.random() }))] : [] }))] : []
          };
          setTemplates(prev => [...prev, newTemplate]);
        }
      };

      const saveTemplate = (templateId) => {
        setTemplates(prev => prev.map(t => 
          t.id === templateId ? { ...t, lastSaved: new Date().toISOString() } : t
        ));
        alert('Template saved successfully!');
      };

      const updateTemplate = (templateId, field, value) => {
        setTemplates(prev => prev.map(t => 
          t.id === templateId ? { ...t, [field]: value } : t
        ));
      };

      const addStep = (templateId) => {
        setTemplates(prev => prev.map(t =>
          t.id === templateId
            ? { ...t, steps: [...t.steps, { id: Date.now(), name: "New Step", type: "instruction", param: "", min: null, max: null, materials: [], instruction: "" }] }
            : t
        ));
      };

      const updateStep = (templateId, stepId, field, value) => {
        setTemplates(prev => prev.map(t =>
          t.id === templateId
            ? { ...t, steps: t.steps.map(s => s.id === stepId ? { ...s, [field]: value } : s) }
            : t
        ));
      };

      const addMaterialToStep = (templateId, stepId) => {
        setTemplates(prev => prev.map(t =>
          t.id === templateId
            ? { 
                ...t, 
                steps: t.steps.map(s => 
                  s.id === stepId 
                    ? { 
                        ...s, 
                        materials: [...(s.materials || []), { 
                          id: Date.now(), 
                          item: "New Material", 
                          quantity: 0, 
                          unit: "mg", 
                          lotNumber: "" 
                        }] 
                      }
                    : s
                )
              }
            : t
        ));
      };

      const updateStepMaterial = (templateId, stepId, materialId, field, value) => {
        setTemplates(prev => prev.map(t =>
          t.id === templateId
            ? { 
                ...t, 
                steps: t.steps.map(s => 
                  s.id === stepId 
                    ? { 
                        ...s, 
                        materials: (s.materials || []).map(m => 
                          m.id === materialId ? { ...m, [field]: value } : m
                        )
                      }
                    : s
                )
              }
            : t
        ));
      };

      const removeMaterialFromStep = (templateId, stepId, materialId) => {
        setTemplates(prev => prev.map(t =>
          t.id === templateId
            ? { 
                ...t, 
                steps: t.steps.map(s => 
                  s.id === stepId 
                    ? { 
                        ...s, 
                        materials: (s.materials || []).filter(m => m.id !== materialId)
                      }
                    : s
                )
              }
            : t
        ));
      };

      // ---------------------------
      // Workflow logic
      // ---------------------------
      const updateWorkflowStep = (sid, value) => {
        setWorkflow(prev => prev.map(s =>
          s.id === sid
            ? {
                ...s,
                value,
                status:
                  s.type === "control"
                    ? (value >= s.min && value <= s.max ? "ok" : "blocked")
                    : "done"
              }
            : s
        ));
      };

      // Equipment management
      const addEquipment = () => {
        setEquipment(prev => [...prev, {
          id: Date.now(),
          name: "New Equipment",
          type: "General",
          status: "maintenance",
          location: "TBD",
          lastCalibration: new Date().toISOString().split('T')[0],
          nextCalibration: new Date(Date.now() + 90*24*60*60*1000).toISOString().split('T')[0]
        }]);
      };

      const updateEquipmentStatus = (equipmentId, newStatus) => {
        setEquipment(prev => prev.map(e => 
          e.id === equipmentId ? {...e, status: newStatus} : e
        ));
      };

      const calibrateEquipment = (equipmentId) => {
        setEquipment(prev => prev.map(e => 
          e.id === equipmentId ? {
            ...e, 
            lastCalibration: new Date().toISOString().split('T')[0],
            nextCalibration: new Date(Date.now() + 90*24*60*60*1000).toISOString().split('T')[0]
          } : e
        ));
      };

      // Personnel management
      const addPersonnel = () => {
        setPersonnel(prev => [...prev, {
          id: Date.now(),
          name: "New Employee",
          role: "Operator",
          department: "Production",
          status: "training",
          lastTraining: new Date().toISOString().split('T')[0],
          certifications: []
        }]);
      };

      const removePersonnel = (personnelId) => {
        setPersonnel(prev => prev.filter(p => p.id !== personnelId));
      };

      const updatePersonnel = (personnelId, field, value) => {
        setPersonnel(prev => prev.map(p => 
          p.id === personnelId ? {...p, [field]: value} : p
        ));
      };

      // ---------------------------
      // Render UI
      // ---------------------------
      return (
        <div className="p-6">
          {/* Header with logo */}
          <header className="flex items-center mb-6">
            <div className="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center mr-3">
              <span className="text-white font-bold">N</span>
            </div>
            <h1 className="text-3xl font-bold">Nobilis.Tech MES</h1>
          </header>

          {/* Navigation */}
          <nav className="flex space-x-4 border-b pb-2 mb-6">
            <button onClick={() => setActiveTab("dashboard")} className={activeTab === "dashboard" ? "font-bold" : ""}><Icons.Dashboard /> Dashboard</button>
            <button onClick={() => setActiveTab("batches")} className={activeTab === "batches" ? "font-bold" : ""}><Icons.Batch /> Batches</button>
            <button onClick={() => setActiveTab("templates")} className={activeTab === "templates" ? "font-bold" : ""}><Icons.Template /> eBR Templates</button>
            <button onClick={() => setActiveTab("workflow")} className={activeTab === "workflow" ? "font-bold" : ""}><Icons.Workflow /> Workflow</button>
            <button onClick={() => setActiveTab("equipment")} className={activeTab === "equipment" ? "font-bold" : ""}>‚öôÔ∏è Equipment</button>
            <button onClick={() => setActiveTab("personnel")} className={activeTab === "personnel" ? "font-bold" : ""}><Icons.User /> Personnel</button>
          </nav>

          {/* Dashboard */}
          {activeTab === "dashboard" && (
            <div>
              <h2 className="text-xl font-semibold mb-4">üìä Production KPIs</h2>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div className="bg-blue-100 p-4 rounded-lg">
                  <div className="text-2xl font-bold text-blue-800">{batches.filter(b => b.status !== "completed").length}</div>
                  <div className="text-sm text-blue-600">Active Batches</div>
                </div>
                <div className="bg-green-100 p-4 rounded-lg">
                  <div className="text-2xl font-bold text-green-800">{batches.filter(b => b.status === "completed").length}</div>
                  <div className="text-sm text-green-600">Completed</div>
                </div>
                <div className="bg-red-100 p-4 rounded-lg">
                  <div className="text-2xl font-bold text-red-800">{batches.filter(b => b.status === "deviation").length}</div>
                  <div className="text-sm text-red-600">Deviations</div>
                </div>
                <div className="bg-purple-100 p-4 rounded-lg">
                  <div className="text-2xl font-bold text-purple-800">{equipment.filter(e => e.status === 'in_operation').length}</div>
                  <div className="text-sm text-purple-600">Equipment Active</div>
                </div>
              </div>
              
              <div className="bg-white border rounded-lg p-4">
                <h3 className="text-lg font-semibold mb-3">Recent Activity</h3>
                <div className="space-y-2">
                  {batches.slice(0, 5).map(batch => (
                    <div key={batch.id} className="flex justify-between items-center py-2 border-b">
                      <div>
                        <span className="font-medium">{batch.id}</span> - {batch.product}
                      </div>
                      <div className="flex items-center space-x-2">
                        <span className={`px-2 py-1 rounded text-xs ${
                          batch.status === 'completed' ? 'bg-green-100 text-green-800' :
                          batch.status === 'deviation' ? 'bg-red-100 text-red-800' :
                          'bg-blue-100 text-blue-800'
                        }`}>
                          {batch.status}
                        </span>
                        <div className="w-20 bg-gray-200 rounded-full h-2">
                          <div 
                            className="bg-blue-600 h-2 rounded-full" 
                            style={{ width: `${batch.progress}%` }}
                          ></div>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          )}

          {/* Batches */}
          {activeTab === "batches" && (
            <div>
              <h2 className="text-xl font-semibold mb-4">üß™ Batch Records</h2>
              {batches.map(b => (
                <div key={b.id} className="border p-3 mb-3 rounded">
                  <div className="flex justify-between items-center">
                    <div>
                      <strong>{b.id}</strong> ‚Äî {b.product}
                      {b.deviation && <span className="text-red-600 ml-2">‚ö†Ô∏è {b.deviation}</span>}
                    </div>
                    <span>Status: {b.status}</span>
                  </div>
                  <div className="w-full bg-gray-200 h-2 my-2">
                    <div className="bg-blue-600 h-2" style={{ width: `${b.progress}%` }}></div>
                  </div>
                  {b.status === "in_progress" && (
                    <div className="flex space-x-2">
                      <button className="bg-green-500 text-white px-3 py-1 rounded" onClick={() => completeStep(b.id)}>‚úÖ Complete Step</button>
                      <button className="bg-red-500 text-white px-3 py-1 rounded" onClick={() => reportDeviation(b.id)}>üö® Report Deviation</button>
                    </div>
                  )}
                </div>
              ))}

              {/* Deviations Management */}
              <div className="mt-6 bg-white border rounded-lg p-4">
                <h3 className="text-lg font-semibold mb-4">üö® Deviation Management</h3>
                <div className="space-y-3">
                  {deviations.map(deviation => (
                    <div key={deviation.id} className="border rounded p-4 bg-gray-50">
                      <div className="flex justify-between items-start mb-2">
                        <div>
                          <h4 className="font-medium">Batch: {deviation.batchId}</h4>
                          <p className="text-gray-600 text-sm">{deviation.description}</p>
                          <div className="text-xs text-gray-500 mt-1">
                            Reported by: {deviation.reportedBy} on {deviation.reportedDate}
                            {deviation.investigator && <span> | Investigator: {deviation.investigator}</span>}
                          </div>
                        </div>
                        <span className={`px-2 py-1 rounded text-xs ${
                          deviation.status === 'approved' ? 'bg-green-100 text-green-800' :
                          deviation.status === 'rejected' ? 'bg-red-100 text-red-800' :
                          'bg-yellow-100 text-yellow-800'
                        }`}>
                          {deviation.status}
                        </span>
                      </div>
                      
                      {deviation.status === 'pending' && (
                        <div className="flex space-x-2 mt-3">
                          <button
                            onClick={() => approveDeviation(deviation.id)}
                            className="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600"
                          >
                            Approve
                          </button>
                          <button
                            onClick={() => rejectDeviation(deviation.id)}
                            className="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600"
                          >
                            Reject
                          </button>
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              </div>
            </div>
          )}

          {/* Templates */}
          {activeTab === "templates" && (
            <div>
              <div className="flex justify-between items-center mb-4">
                <h2 className="text-xl font-semibold">üìã eBR Templates</h2>
                <button className="bg-green-600 text-white px-3 py-1 rounded" onClick={addTemplate}><Icons.Plus /> Add Template</button>
              </div>
              {templates.map(t => (
                <div key={t.id} className="border p-3 mb-3 rounded">
                  <div className="flex justify-between items-center mb-3">
                    <div className="flex-1">
                      <div className="flex items-center space-x-4 mb-2">
                        <input
                          className="text-lg font-semibold bg-transparent border-b border-transparent hover:border-gray-300 focus:border-blue-500 focus:outline-none"
                          value={t.name}
                          onChange={(e) => updateTemplate(t.id, 'name', e.target.value)}
                        />
                        <input
                          className="text-sm bg-transparent border-b border-transparent hover:border-gray-300 focus:border-blue-500 focus:outline-none w-16"
                          value={t.version}
                          onChange={(e) => updateTemplate(t.id, 'version', e.target.value)}
                        />
                      </div>
                      <div className="flex items-center space-x-4 text-sm text-gray-600">
                        <span>Created: {t.createdDate}</span>
                        <select
                          value={t.status}
                          onChange={(e) => updateTemplate(t.id, 'status', e.target.value)}
                          className="border rounded px-2 py-1"
                        >
                          <option value="draft">Draft</option>
                          <option value="review">Review</option>
                          <option value="approved">Approved</option>
                        </select>
                      </div>
                    </div>
                    <div className="flex space-x-2">
                      <button
                        onClick={() => saveTemplate(t.id)}
                        className="p-2 text-green-600 hover:bg-green-100 rounded"
                        title="Save Template"
                      >
                        <Icons.Save />
                      </button>
                      <button
                        onClick={() => createNewVersion(t.id)}
                        className="p-2 text-purple-600 hover:bg-purple-100 rounded"
                        title="Create New Version"
                      >
                        üìù
                      </button>
                      <button
                        onClick={() => cloneTemplate(t.id)}
                        className="p-2 text-blue-600 hover:bg-blue-100 rounded"
                        title="Clone Template"
                      >
                        <Icons.Copy />
                      </button>
                      <button
                        onClick={() => setSelectedTemplate(selectedTemplate === t.id ? null : t.id)}
                        className="p-2 text-gray-600 hover:bg-gray-100 rounded"
                        title="Edit Template"
                      >
                        <Icons.Edit />
                      </button>
                    </div>
                  </div>

                  {selectedTemplate === t.id && (
                    <div className="border-t pt-4 space-y-4">
                      {/* Steps Section */}
                      <div>
                        <div className="flex justify-between items-center mb-3">
                          <h4 className="text-md font-semibold">üîÑ Process Steps (BOP - Bill of Process)</h4>
                          <button
                            onClick={() => addStep(t.id)}
                            className="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700"
                          >
                            Add Step
                          </button>
                        </div>
                        <div className="space-y-3">
                          {t.steps?.map((step, index) => (
                            <div key={step.id} className="border rounded p-4 bg-gray-50">
                              <div className="grid grid-cols-2 gap-3 mb-3">
                                <div>
                                  <label className="block text-xs text-gray-600 mb-1">Step Name</label>
                                  <input
                                    className="w-full border px-2 py-1 rounded"
                                    value={step.name}
                                    onChange={(e) => updateStep(t.id, step.id, "name", e.target.value)}
                                  />
                                </div>
                                <div>
                                  <label className="block text-xs text-gray-600 mb-1">Type</label>
                                  <select
                                    className="w-full border px-2 py-1 rounded"
                                    value={step.type}
                                    onChange={(e) => updateStep(t.id, step.id, "type", e.target.value)}
                                  >
                                    <option value="instruction">Instruction</option>
                                    <option value="input">Data Input</option>
                                    <option value="control">Quality Control</option>
                                  </select>
                                </div>
                              </div>

                              {(step.type === "input" || step.type === "control") && (
                                <div className="grid grid-cols-3 gap-2 mb-3">
                                  <div>
                                    <label className="block text-xs text-gray-600 mb-1">Parameter</label>
                                    <input
                                      className="w-full border px-2 py-1 rounded"
                                      placeholder="Parameter name"
                                      value={step.param}
                                      onChange={(e) => updateStep(t.id, step.id, "param", e.target.value)}
                                    />
                                  </div>
                                  <div>
                                    <label className="block text-xs text-gray-600 mb-1">Min Value</label>
                                    <input
                                      type="number"
                                      className="w-full border px-2 py-1 rounded"
                                      value={step.min || ""}
                                      onChange={(e) => updateStep(t.id, step.id, "min", parseFloat(e.target.value))}
                                    />
                                  </div>
                                  <div>
                                    <label className="block text-xs text-gray-600 mb-1">Max Value</label>
                                    <input
                                      type="number"
                                      className="w-full border px-2 py-1 rounded"
                                      value={step.max || ""}
                                      onChange={(e) => updateStep(t.id, step.id, "max", parseFloat(e.target.value))}
                                    />
                                  </div>
                                </div>
                              )}

                              <div className="mb-3">
                                <label className="block text-xs text-gray-600 mb-1">Instructions</label>
                                <textarea
                                  className="w-full border px-2 py-1 rounded"
                                  rows="2"
                                  placeholder="Detailed instructions for this step..."
                                  value={step.instruction || ""}
                                  onChange={(e) => updateStep(t.id, step.id, "instruction", e.target.value)}
                                />
                              </div>

                              {/* Materials for this step */}
                              <div className="mb-3">
                                <div className="flex justify-between items-center mb-2">
                                  <label className="block text-xs text-gray-600">Materials Required for This Step</label>
                                  <button
                                    onClick={() => addMaterialToStep(t.id, step.id)}
                                    className="bg-blue-500 text-white px-2 py-1 rounded text-xs hover:bg-blue-600"
                                  >
                                    Add Material
                                  </button>
                                </div>
                                {step.materials && step.materials.length > 0 && (
                                  <div className="space-y-2 bg-blue-50 p-2 rounded">
                                    {step.materials.map(material => (
                                      <div key={material.id} className="grid grid-cols-5 gap-2 items-center">
                                        <input
                                          className="border px-2 py-1 rounded text-xs"
                                          placeholder="Material name"
                                          value={material.item}
                                          onChange={(e) => updateStepMaterial(t.id, step.id, material.id, 'item', e.target.value)}
                                        />
                                        <input
                                          type="number"
                                          className="border px-2 py-1 rounded text-xs"
                                          placeholder="Qty"
                                          value={material.quantity}
                                          onChange={(e) => updateStepMaterial(t.id, step.id, material.id, 'quantity', e.target.value)}
                                        />
                                        <input
                                          className="border px-2 py-1 rounded text-xs"
                                          placeholder="Unit"
                                          value={material.unit}
                                          onChange={(e) => updateStepMaterial(t.id, step.id, material.id, 'unit', e.target.value)}
                                        />
                                        <input
                                          className="border px-2 py-1 rounded text-xs"
                                          placeholder="Lot#"
                                          value={material.lotNumber}
                                          onChange={(e) => updateStepMaterial(t.id, step.id, material.id, 'lotNumber', e.target.value)}
                                        />
                                        <button
                                          onClick={() => removeMaterialFromStep(t.id, step.id, material.id)}
                                          className="p-1 text-red-600 hover:bg-red-100 rounded text-xs"
                                        >
                                          üóëÔ∏è
                                        </button>
                                      </div>
                                    ))}
                                  </div>
                                )}
                              </div>

                              <div className="flex justify-between items-center">
                                <div className="text-xs text-gray-500">
                                  Step {index + 1} of {t.steps.length}
                                </div>
                                <button
                                  onClick={() => setTemplates(prev => prev.map(template =>
                                    template.id === t.id
                                      ? { ...template, steps: template.steps.filter(s => s.id !== step.id) }
                                      : template
                                  ))}
                                  className="p-2 text-red-600 hover:bg-red-100 rounded"
                                >
                                  <Icons.Trash />
                                </button>
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              ))}
            </div>
          )}

          {/* Workflow */}
          {activeTab === "workflow" && (
            <div>
              <h2 className="text-xl font-semibold mb-4">üîÑ Workflow Execution</h2>
              {workflow.map(s => (
                <div key={s.id} className="border p-3 mb-2 rounded">
                  <div className="flex justify-between">
                    <strong>{s.name}</strong>
                    <span>Status: {s.status}</span>
                  </div>
                  {s.type === "instruction" && (
                    <button className="bg-blue-500 text-white px-2 py-1 mt-2 rounded" onClick={() => updateWorkflowStep(s.id, "confirmed")}>Confirm</button>
                  )}
                  {s.type === "input" && (
                    <input type="number" className="border px-2 py-1 mt-2 w-full"
                      placeholder={s.param}
                      onChange={e => updateWorkflowStep(s.id, parseFloat(e.target.value))}
                    />
                  )}
                  {s.type === "control" && (
                    <input type="number" className="border px-2 py-1 mt-2 w-full"
                      placeholder={`${s.param} (${s.min}-${s.max})`}
                      onChange={e => updateWorkflowStep(s.id, parseFloat(e.target.value))}
                    />
                  )}
                </div>
              ))}
            </div>
          )}

          {/* Equipment */}
          {activeTab === "equipment" && (
            <div>
              <div className="flex justify-between items-center mb-4">
                <h2 className="text-xl font-semibold">‚öôÔ∏è Equipment Management</h2>
                <button 
                  onClick={addEquipment}
                  className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 flex items-center space-x-2"
                >
                  <Icons.Plus />
                  <span>Add Equipment</span>
                </button>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {equipment.map(eq => (
                  <div key={eq.id} className="bg-white border rounded-lg p-4">
                    <div className="flex justify-between items-start mb-3">
                      <div>
                        <h3 className="font-semibold text-lg">{eq.name}</h3>
                        <p className="text-gray-600 text-sm">{eq.type}</p>
                      </div>
                      <span className={`px-2 py-1 rounded text-xs ${
                        eq.status === 'in_operation' ? 'bg-green-100 text-green-800' :
                        eq.status === 'cleaning' ? 'bg-blue-100 text-blue-800' :
                        eq.status === 'calibration' ? 'bg-yellow-100 text-yellow-800' :
                        'bg-red-100 text-red-800'
                      }`}>
                        {eq.status}
                      </span>
                    </div>
                    
                    <div className="space-y-2 text-sm">
                      <div><strong>Location:</strong> {eq.location}</div>
                      <div><strong>Last Calibration:</strong> {eq.lastCalibration}</div>
                      <div><strong>Next Calibration:</strong> {eq.nextCalibration}</div>
                    </div>

                    <div className="mt-4 flex space-x-2">
                      <select 
                        value={eq.status}
                        onChange={(e) => updateEquipmentStatus(eq.id, e.target.value)}
                        className="flex-1 border px-2 py-1 rounded text-xs"
                      >
                        <option value="in_operation">In Operation</option>
                        <option value="cleaning">Cleaning</option>
                        <option value="calibration">Calibration</option>
                        <option value="maintenance">Maintenance</option>
                      </select>
                      <button 
                        onClick={() => calibrateEquipment(eq.id)}
                        className="bg-blue-500 text-white px-2 py-1 rounded text-xs"
                      >
                        Calibrate
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* Personnel */}
          {activeTab === "personnel" && (
            <div>
              <div className="flex justify-between items-center mb-4">
                <h2 className="text-xl font-semibold">üë§ Personnel Management</h2>
                <button 
                  onClick={addPersonnel}
                  className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 flex items-center space-x-2"
                >
                  <Icons.Plus />
                  <span>Add Personnel</span>
                </button>
              </div>

              <div className="bg-white border rounded-lg overflow-hidden">
                <table className="w-full">
                  <thead className="bg-gray-50">
                    <tr>
                      <th className="px-4 py-3 text-left">Name</th>
                      <th className="px-4 py-3 text-left">Role</th>
                      <th className="px-4 py-3 text-left">Department</th>
                      <th className="px-4 py-3 text-left">Status</th>
                      <th className="px-4 py-3 text-left">Last Training</th>
                      <th className="px-4 py-3 text-left">Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {personnel.map((person, index) => (
                      <tr key={person.id} className={index % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                        <td className="px-4 py-3">
                          <input 
                            className="w-full bg-transparent border-none"
                            value={person.name}
                            onChange={(e) => updatePersonnel(person.id, 'name', e.target.value)}
                          />
                        </td>
                        <td className="px-4 py-3">
                          <select 
                            value={person.role}
                            onChange={(e) => updatePersonnel(person.id, 'role', e.target.value)}
                            className="w-full border rounded px-2 py-1"
                          >
                            <option value="Operator">Operator</option>
                            <option value="QC Analyst">QC Analyst</option>
                            <option value="Supervisor">Supervisor</option>
                            <option value="Manager">Manager</option>
                          </select>
                        </td>
                        <td className="px-4 py-3">{person.department}</td>
                        <td className="px-4 py-3">
                          <span className={`px-2 py-1 rounded text-xs ${
                            person.status === 'active' ? 'bg-green-100 text-green-800' :
                            person.status === 'training' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-red-100 text-red-800'
                          }`}>
                            {person.status}
                          </span>
                        </td>
                        <td className="px-4 py-3">{person.lastTraining}</td>
                        <td className="px-4 py-3">
                          <div className="flex space-x-2">
                            <button 
                              onClick={() => updatePersonnel(person.id, 'status', person.status === 'active' ? 'inactive' : 'active')}
                              className="text-blue-600 hover:bg-blue-100 px-2 py-1 rounded text-xs"
                            >
                              Toggle
                            </button>
                            <button 
                              onClick={() => removePersonnel(person.id)}
                              className="text-red-600 hover:bg-red-100 px-2 py-1 rounded text-xs"
                            >
                              Remove
                            </button>
                          </div>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>

              {/* Certifications Overview */}
              <div className="mt-6 bg-white border rounded-lg p-4">
                <h3 className="text-lg font-semibold mb-3">Training & Certifications</h3>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  {personnel.map(person => (
                    <div key={person.id} className="border rounded p-3">
                      <h4 className="font-medium">{person.name}</h4>
                      <div className="text-sm text-gray-600 mt-1">
                        {person.certifications.length > 0 ? (
                          <ul className="list-disc list-inside">
                            {person.certifications.map((cert, i) => (
                              <li key={i}>{cert}</li>
                            ))}
                          </ul>
                        ) : (
                          <span className="text-gray-400">No certifications</span>
                        )}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    // Render
    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>